<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HNI Battle Online</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="game-wrapper">

    <button id="help-btn" class="help-btn hidden" title="Guia de Golpes">?</button>
    <button id="gm-mode-switch-btn" class="gm-mode-switch-btn hidden" title="Mudar Modo de Jogo">üîÑ</button>

    <div id="dice-cheat-indicator" class="cheat-indicator hidden"></div>

    <!-- TELA DE SENHA -->
    <div id="password-screen" class="screen active">
        <h1>Acesso do Mestre</h1>
        <input type="password" id="password-input" placeholder="Digite a senha">
        <button id="password-submit-btn" class="mode-btn">Entrar</button>
    </div>

    <!-- TELA DE LOBBY DO GM -->
    <div id="gm-initial-lobby" class="screen">
        <h1>Lobby do Mestre</h1>
        <p>Envie o link abaixo para convidar participantes.</p>
        <div class="gm-links-container">
            <div>
                <h3>Link de Convite:</h3>
                <div id="gm-link-invite" class="share-link" title="Clique para copiar">Gerando...</div>
            </div>
        </div>
        <div id="gm-lobby-status-container">
            <h3>Jogadores Conectados:</h3>
            <ul id="gm-lobby-player-list">
                <li>Aguardando jogadores...</li>
            </ul>
        </div>
        <h2>Selecione o Modo de Jogo para Iniciar</h2>
        <div class="mode-buttons-container">
            <button id="start-classic-btn" class="mode-btn">Player vs. "NPC" (Cl√°ssico)</button>
            <button id="start-arena-btn" class="mode-btn">Player vs. Player (Arena)</button>
            <button id="start-theater-btn" class="mode-btn">Cen√°rios (GM)</button>
        </div>
        <button id="exit-game-btn" class="back-btn hidden" title="Voltar ao Menu Principal">‚åÇ</button>
    </div>
    
    <!-- NOVA TELA: SELE√á√ÉO DE PAPEL -->
    <div id="role-selection-screen" class="screen">
        <h1>Bem-vindo!</h1>
        <p>Voc√™ foi convidado para uma sess√£o de HNI Battle Online.</p>
        <h2>Como deseja participar?</h2>
        <div class="mode-buttons-container">
            <button id="role-player-btn" class="mode-btn">Entrar como Jogador</button>
            <button id="role-spectator-btn" class="mode-btn">Entrar como Espectador</button>
        </div>
    </div>


    <!-- TELA DE ESPERA DO JOGADOR/ESPECTADOR -->
    <div id="player-waiting-screen" class="screen">
         <h1>HNI Battle Online</h1>
         <p id="player-waiting-message">Aguardando o Mestre iniciar o jogo...</p>
    </div>
    
    <!-- TELA DE SELE√á√ÉO DE MODO DE JOGO (REMOVIDA DO FLUXO INICIAL, AGORA DENTRO DO LOBBY DO GM) -->
    <div id="mode-selection-screen" class="screen">
        <h1>HNI Battle Online</h1>
        <h2>Selecione o Modo de Jogo</h2>
        <div class="mode-buttons-container">
            <button id="mode-classic-btn" class="mode-btn">Player vs. "NPC" (Cl√°ssico)</button>
            <button id="mode-arena-btn" class="mode-btn">Player vs. Player (Arena)</button>
            <button id="mode-theater-btn" class="mode-btn">Cen√°rios (GM)</button>
        </div>
    </div>

    <!-- TELA DE SELE√á√ÉO DE CEN√ÅRIO (REUTILIZADA) -->
    <div id="scenario-screen" class="screen">
        <h1 id="scenario-title">Selecione o Cen√°rio</h1>
        <div id="scenario-category-tabs"></div>
        <div id="scenario-list-container"></div>
    </div>
    
    <!-- TELA DO MODO TEATRO -->
    <div id="theater-screen" class="screen">
        <div id="theater-background-viewport">
            <div id="theater-world-container">
                <img id="theater-background-image" src="" alt="Cen√°rio do Teatro">
                <div id="theater-token-container"></div>
                <div id="selection-box" class="hidden"></div>
            </div>
        </div>

        <button id="copy-theater-spectator-link" class="copy-link-button hidden" title="Copiar link de espectador">üîó</button>
        
        <button id="toggle-gm-panel-btn" class="toggle-gm-panel-btn hidden" title="Mostrar/Ocultar Painel">‚ò∞</button>
        
        <div id="theater-gm-panel" class="hidden">
            <div class="panel-section">
                <h4>Personagens</h4>
                <div id="theater-char-list"></div>
            </div>
            <div class="panel-section">
                <h4>Controles Gerais</h4>
                <label for="theater-global-scale">Escala Global:</label>
                <input type="range" id="theater-global-scale" min="0.2" max="3" step="0.1" value="1">
                <button id="theater-change-scenario-btn">Mudar Cen√°rio</button>
                <button id="theater-publish-btn" class="hidden">Publicar Cena</button>
            </div>
             <div class="panel-section" id="theater-gm-legend">
                <h4>Atalhos (GM)</h4>
                <p><b>G:</b> Sele√ß√£o em Grupo</p>
                <p><b>F:</b> Virar Personagem</p>
                <p><b>Setas ‚Üë‚Üì:</b> Mudar Camada</p>
                <p><b>Delete:</b> Excluir</p>
                <p><b>O (hover):</b> Resetar Tamanho</p>
            </div>
        </div>
        <button id="theater-back-btn" class="back-btn hidden" title="Voltar ao Menu Principal">‚åÇ</button>
    </div>


    <!-- TELA DE SELE√á√ÉO DE PERSONAGENS -->
    <div id="selection-screen" class="screen">
        <button id="char-select-back-btn" class="back-btn" title="Voltar para Cen√°rios">‚Üê</button>
        <h1 id="selection-title">Selecione seu Lutador</h1>
        <div id="character-list-container"></div>
        <button id="confirm-selection-btn">Confirmar</button>
    </div>

    <!-- TELA DE LUTA -->
    <div id="fight-screen" class="screen">
        <div id="gm-cheats-panel" class="hidden">
            <h4>Atalhos GM</h4>
            <p><b>C:</b> Pausar / Cheats</p>
            <p><b>T:</b> For√ßar Cr√≠tico</p>
            <p><b>R:</b> For√ßar Erro</p>
            <p><b>Y:</b> For√ßar Valor Dado</p>
            <p><b>I:</b> Alternar Ilegal</p>
        </div>

        <img src="images/lutadores/Kureha Shoji.png" alt="Jogador 1" class="fighter-img" id="player1-fight-img">
        <img src="" alt="Jogador 2" id="player2-fight-img" class="fighter-img">

        <button id="copy-spectator-link-ingame" class="copy-link-button hidden" title="Copiar link de espectador">üîó</button>

        <div id="fight-ui-wrapper">
            <div class="fight-ui-container">
                <!-- √ÅREA JOGADOR 1 -->
                <div class="fighter-info" id="player1-area">
                    <h2 id="player1-fight-name">Jogador 1</h2>
                    <div class="stats-bar"><span>HP: </span><div class="hp-bar-container"><div id="player1-hp-bar" class="hp-bar"></div></div><span id="player1-hp-text">10 / 10</span></div>
                    <div class="pa-display"><span>PA:</span><div class="pa-dots-container" id="player1-pa-dots"></div></div>
                    <div class="defense-display">
                        <p class="stat-text" id="player1-agi-text">AGI: 0</p>
                        <div class="def-shield">
                            <img src="images/def.png" alt="Defesa">
                            <span class="defense-text" id="player1-def-text">0</span>
                        </div>
                        <p class="stat-text" id="player1-res-text">RES: 0</p>
                    </div>
                    <p>Acertos: <span id="player1-hits">0</span></p>
                    <p>Quedas: <span id="player1-knockdowns">0</span></p>
                    <p>Dano Recebido: <span id="player1-damage-taken">0</span></p>
                    <p>Penalidades: <span id="player1-point-deductions">0</span></p>
                </div>
                <!-- LOG DE LUTA -->
                <div id="fight-log-container">
                    <h2 id="round-info">ROUND 1</h2>
                    <div id="fight-log"></div>
                </div>
                <!-- √ÅREA JOGADOR 2 -->
                <div class="fighter-info" id="player2-area">
                    <h2 id="player2-fight-name">Jogador 2</h2>
                    <div class="stats-bar"><span>HP: </span><div class="hp-bar-container"><div id="player2-hp-bar" class="hp-bar"></div></div><span id="player2-hp-text">15 / 15</span></div>
                    <div class="pa-display"><span>PA:</span><div class="pa-dots-container" id="player2-pa-dots"></div></div>
                    <div class="defense-display">
                        <p class="stat-text" id="player2-agi-text">AGI: 0</p>
                        <div class="def-shield">
                            <img src="images/def.png" alt="Defesa">
                            <span class="defense-text" id="player2-def-text">0</span>
                        </div>
                        <p class="stat-text" id="player2-res-text">RES: 0</p>
                    </div>
                    <p>Acertos: <span id="player2-hits">0</span></p>
                    <p>Quedas: <span id="player2-knockdowns">0</span></p>
                    <p>Dano Recebido: <span id="player2-damage-taken">0</span></p>
                    <p>Penalidades: <span id="player2-point-deductions">0</span></p>
                </div>
            </div>
            <!-- BOT√ïES DE A√á√ÉO -->
            <div id="action-buttons-wrapper">
                <!-- BOT√ïES DO JOGADOR 1 (VERMELHOS) -->
                <div id="p1-controls" class="move-buttons hidden">
                    <button class="action-btn p1-btn" data-move="Jab">Jab (1 PA)</button>
                    <button class="action-btn p1-btn" data-move="Direto">Direto (2 PA)</button>
                    <button class="action-btn p1-btn" data-move="Upper">Upper (3 PA)</button>
                    <button class="action-btn p1-btn" data-move="Liver Blow">Liver Blow (3 PA)</button>
                    <button class="action-btn p1-btn" data-move="Clinch">Clinch (3 PA)</button>
                    <button class="action-btn p1-btn" data-move="Esquiva" data-reaction="true">Esquiva (1 PA)</button>
                    <button class="action-btn p1-btn illegal-btn" data-move="Golpe Ilegal">Golpe Ilegal (2 PA)</button>
                    <div id="p1-special-moves" class="special-moves-container"></div>
                    <button id="p1-end-turn-btn" class="end-turn-btn">ENCERRAR O TURNO</button>
                </div>
                <!-- BOT√ïES DO JOGADOR 2 (AZUIS) -->
                <div id="p2-controls" class="move-buttons hidden">
                    <button class="action-btn p2-btn" data-move="Jab">Jab (1 PA)</button>
                    <button class="action-btn p2-btn" data-move="Direto">Direto (2 PA)</button>
                    <button class="action-btn p2-btn" data-move="Upper">Upper (3 PA)</button>
                    <button class="action-btn p2-btn" data-move="Liver Blow">Liver Blow (3 PA)</button>
                    <button class="action-btn p2-btn" data-move="Clinch">Clinch (3 PA)</button>
                    <button class="action-btn p2-btn" data-move="Esquiva" data-reaction="true">Esquiva (1 PA)</button>
                    <button class="action-btn p2-btn illegal-btn" data-move="Golpe Ilegal">Golpe Ilegal (2 PA)</button>
                    <div id="p2-special-moves" class="special-moves-container"></div>
                    <button id="p2-end-turn-btn" class="end-turn-btn">ENCERRAR O TURNO</button>
                </div>
                <div id="utility-buttons">
                    <button id="forfeit-btn">Jogar a Toalha</button>
                </div>
            </div>
        </div>

        <!-- BOT√ïES DE ROLAGEM -->
        <button id="player1-roll-btn" class="roll-dice-button hidden"></button>
        <button id="player2-roll-btn" class="roll-dice-button hidden"></button>

        <!-- OVERLAYS -->
        <div id="dice-overlay" class="hidden"></div>
        <div id="player1-dice-result" class="dice-result hidden"></div>
        <div id="player2-dice-result" class="dice-result hidden"></div>

        <div id="game-alert-overlay" class="hidden">
            <div id="game-alert-content"></div>
        </div>
        
        <div id="player1-dk-result" class="dk-result-overlay hidden"></div>
        <div id="player2-dk-result" class="dk-result-overlay hidden"></div>
    </div>

    <!-- MODAL PADR√ÉO -->
    <div id="modal" class="hidden">
        <div id="modal-content">
            <h3 id="modal-title">T√≠tulo</h3>
            <div id="modal-text">Texto.</div>
            <button id="modal-button">OK</button>
        </div>
    </div>

    <!-- NOVO MODAL: CONFIGURA√á√ÉO DE JOGADOR (PARA O GM) -->
    <div id="player-config-modal" class="hidden">
        <div id="player-config-content">
            <h3 id="player-config-title">Configurar Jogador</h3>
            <div id="player-config-body">
                <!-- Conte√∫do ser√° injetado dinamicamente -->
            </div>
            <button id="confirm-player-config-btn">Confirmar Configura√ß√£o</button>
        </div>
    </div>
    
    <!-- MODAL DE SELE√á√ÉO DE GOLPES ESPECIAIS (REMOVIDO DO FLUXO PRINCIPAL) -->
    <div id="special-moves-modal" class="hidden">
        <div id="special-moves-content">
             <button id="special-moves-back-btn" class="back-btn" title="Voltar para Personagens">‚Üê</button>
            <h3 id="special-moves-title">Selecione seus Golpes Especiais</h3>
            <div id="special-moves-list"></div>
            <button id="confirm-special-moves-btn">Confirmar Golpes</button>
        </div>
    </div>

    <div id="get-up-success-overlay" class="hidden">
        <div id="get-up-success-content"></div>
    </div>

</div>

<script src="/socket.io/socket.io.js"></script>
<script src="client.js"></script>
</body>
</html>