<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medieval Battle RPG</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="game-wrapper">

    <!-- TELA DE CARREGAMENTO PARA EVITAR O "FLASH" -->
    <div id="loading-screen" class="screen active">
        <h1>Medieval Battle RPG</h1>
        <p>Conectando ao servidor...</p>
    </div>
    
    <!-- TELA INICIAL DO LOBBY DO GM -->
    <div id="gm-initial-lobby" class="screen">
        <h1>Lobby do Mestre</h1>
        <p>Envie o link de convite para os participantes.</p>
        <div class="gm-links-container">
            <div>
                <h3>Link de Convite:</h3>
                <div id="gm-link-invite" class="share-link" title="Clique para copiar">Gerando...</div>
            </div>
        </div>
        <div id="gm-lobby-status-container">
            <h3>Jogadores Conectados:</h3>
            <ul id="gm-lobby-player-list"></ul>
        </div>
        <div class="mode-buttons-container">
            <button id="start-adventure-btn" class="mode-btn">Iniciar Aventura</button>
            <button id="start-theater-btn" class="mode-btn">Modo Cenário</button>
        </div>
    </div>
    
    <!-- TELA DE ESCOLHA DE PAPEL -->
    <div id="role-selection-screen" class="screen">
        <h1>Bem-vindo!</h1>
        <p>Como você deseja entrar na sala?</p>
        <div class="mode-buttons-container">
            <button id="join-as-player-btn" class="mode-btn">Jogar</button>
            <button id="join-as-spectator-btn" class="mode-btn">Assistir</button>
        </div>
        <p id="room-full-message" class="hidden" style="margin-top: 20px; color: #ffc107;"></p>
    </div>

    <!-- Tela para o GM selecionar os NPCs e definir stats -->
    <div id="gm-npc-setup-screen" class="screen">
        <h1>Montar Encontro</h1>
        <p>Clique em um slot vago e depois em um inimigo para adicioná-lo. Clique em um inimigo já posicionado para editá-lo.</p>

        <div class="npc-setup-layout">
            <div id="npc-staging-area-container">
                <h3>Inimigos na Batalha:</h3>
                <div id="npc-staging-area"></div>
            </div>
            <div class="npc-selection-wrapper">
                 <div id="npc-selection-area"></div>
            </div>
        </div>
        
        <button id="gm-start-battle-btn" class="mode-btn">Iniciar Batalha!</button>
    </div>

    <!-- TELA DE ESPERA DO JOGADOR/ESPECTADOR -->
    <div id="player-waiting-screen" class="screen">
         <h1>Medieval Battle RPG</h1>
         <p id="player-waiting-message">Aguardando o Mestre iniciar o jogo...</p>
    </div>
    
    <!-- TELA DE SELEÇÃO DE PERSONAGENS (Para jogadores) -->
    <div id="selection-screen" class="screen">
        <h1 id="selection-title">Selecione seu Personagem</h1>
        <div id="character-list-container"></div>
        <button id="confirm-selection-btn">Confirmar</button>
    </div>

    <!-- ====================================================== -->
    <!--      NOVAS TELAS DE CRIAÇÃO DE PERSONAGEM (INÍCIO)     -->
    <!-- ====================================================== -->
    
    <!-- TELA HUB DO JOGADOR: NOVO OU CARREGAR -->
    <div id="player-hub-screen" class="screen">
        <h1>Criação de Personagem</h1>
        <p>Deseja criar um novo personagem ou carregar um existente?</p>
        <div class="mode-buttons-container">
            <button id="new-char-btn" class="mode-btn">Novo Personagem</button>
            <button id="load-char-btn" class="mode-btn">Carregar Personagem</button>
        </div>
        <input type="file" id="char-file-input" class="hidden" accept=".char">
    </div>

    <!-- TELA PRINCIPAL DA FICHA DE PERSONAGEM -->
    <div id="character-creation-screen" class="screen">
        <div class="sheet-container">
            <h1>Ficha de Personagem</h1>
            <div class="char-sheet-form">
                
                <div class="sheet-section">
                    <h2>Informações Básicas</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="char-name-input">Nome do Personagem:</label>
                            <input type="text" id="char-name-input" placeholder="Ex: Aragon">
                        </div>
                        <div class="form-group">
                            <label for="char-class-input">Classe:</label>
                            <input type="text" id="char-class-input" placeholder="Ex: Bárbaro, Patrulheiro...">
                        </div>
                        <div class="form-group">
                            <label for="char-race-select">Raça:</label>
                            <select id="char-race-select">
                                <option value="">-- Selecione uma Raça --</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="sheet-section">
                    <h2>Atributos Básicos <span class="points-counter">(Pontos restantes: <span id="attr-points-remaining">5</span>)</span></h2>
                    <div id="attributes-container" class="point-buy-grid"></div>
                </div>

                <div class="sheet-section">
                    <h2>Elementos <span class="points-counter">(Pontos restantes: <span id="elem-points-remaining">2</span>)</span></h2>
                    <div id="elements-container" class="point-buy-grid"></div>
                    <p id="advanced-element-info" class="info-text hidden"></p>
                </div>

                <div class="sheet-section">
                    <h2>Equipamentos Iniciais <span class="points-counter">Moedas: <span id="char-money">200</span></span></h2>
                    <div class="equipment-grid">
                        <div class="form-group equip-group">
                            <label>Arma 1:</label>
                            <input type="text" id="char-weapon-1-name" placeholder="Nome da Arma">
                            <select id="char-weapon-1-type"></select>
                        </div>
                        <div class="form-group equip-group">
                            <label>Arma 2:</label>
                            <input type="text" id="char-weapon-2-name" placeholder="Nome da Arma">
                            <select id="char-weapon-2-type"></select>
                        </div>
                        <div class="form-group equip-group">
                            <label>Escudo:</label>
                            <select id="char-shield-select"></select>
                        </div>
                    </div>
                </div>

            </div>
            <button id="sheet-next-btn" class="mode-btn">Próximo</button>
        </div>
    </div>
    
    <!-- TELA DE SELEÇÃO DE MAGIAS -->
    <div id="spell-selection-screen" class="screen">
        <h1>Escolha suas Magias Iniciais</h1>
        <p id="spell-selection-info">Selecione 2 magias de Grau 1</p>
        <div id="spell-list-container"></div>
        <div class="mode-buttons-container">
            <button id="save-char-btn" class="mode-btn">Salvar Ficha</button>
            <button id="finalize-char-btn" class="mode-btn">Concluir</button>
        </div>
    </div>
    <!-- ====================================================== -->
    <!--       NOVAS TELAS DE CRIAÇÃO DE PERSONAGEM (FIM)       -->
    <!-- ====================================================== -->

    <!-- TELA DE LUTA -->
    <div id="fight-screen" class="screen">
        <div id="fight-scene-characters"></div>
        <div id="turn-order-sidebar"></div>
        <div id="fight-log-container">
            <h2 id="round-info">ROUND 1</h2>
            <div id="fight-log"></div>
        </div>
        <div id="initiative-ui" class="hidden"></div>
        <div id="targeting-indicator" class="hidden">Selecione um alvo!</div>
        <div id="action-buttons-wrapper"></div>
    </div>

    <!-- MODAL PADRÃO -->
    <div id="modal" class="hidden">
        <div id="modal-content">
            <h3 id="modal-title">Título</h3>
            <div id="modal-text">Texto.</div>
            <button id="modal-button">OK</button>
        </div>
    </div>

    <!-- NOVO: MODAL DE EDIÇÃO DE NPC -->
    <div id="npc-editor-modal" class="hidden">
        <div class="sheet-container">
            <h1 id="npc-editor-title">Editar Inimigo</h1>
            <div class="char-sheet-form">
                <div class="sheet-section">
                    <h2>Atributos</h2>
                    <div id="npc-attributes-container" class="point-buy-grid"></div>
                </div>
                 <div class="sheet-section">
                    <h2>Magias (Grau 1)</h2>
                    <div id="npc-spell-container" class="spell-select-grid"></div>
                </div>
            </div>
            <div class="mode-buttons-container">
                <button id="npc-editor-save-btn" class="mode-btn">Salvar Alterações</button>
                <button id="npc-editor-cancel-btn" class="mode-btn">Cancelar</button>
            </div>
        </div>
    </div>

</div>

<script src="/socket.io/socket.io.js"></script>
<script src="client.js"></script>
</body>
</html>